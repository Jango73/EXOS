# Terminal Tactics - Technical Design Document

## Game Overview
**Terminal Tactics** is a real-time strategy game in pure ASCII with an infinite wraparound planetary map and console-friendly interface.

**Core rule: ALL gameplay rules apply identically to human and AI teams. The only differences are AI decision-making and the absence of UI for AI.**

## Core Architecture

### Display System
```
┌─────────────────────────────────────────────────────┐
│ Day: 14   PLASMA: 5,250    ENERGY: 240/500         │ <- Top Bar (resources)
│ PLASMA: 180       SIGHT: 45°                        │
├─────────────────────────────────────────────────────┤
│ ..............##....$.......                        │
│ ....@@@......###..........##...                     │
│ ....@A@......##...........##...                     │
│ ....@@@.......M1.............$                      │
│ .............###............                        │
│ ..............##.............                       │
│ .........TTT...........&&&...                       │
│ .........T1T...........&B&...                       │
│ .........TTT...........&&&...                       │
│ ..................SS.........                       │
│ ..................SS.........                       │
│ ..................SS.........                       │
│ .....$$$....................                        │
│ .....$C$........................................    │
│ .....$$$........................................    │
├─────────────────────────────────────────────────────┤
│ [B]uild [U]nits [R]esearch [M]ap [O]rders           │ <- Bottom Menu Bar
│ Status                                              │
└─────────────────────────────────────────────────────┘
```

**Viewport:**
- Fixed size: 80x25 characters (80 width, 25 height total)
- Visible map area: 80x20 characters (lines 3-22)
- Top bar: 2 lines
- Bottom menu: 3 lines
- Map scrolls with arrow keys
- **Map wraps infinitely** in all directions (planetary projection)

### 2. Resource System

| Terminal Tactics | Purpose |
|------------------|---------|
| **PLASMA** (P) | Primary currency, spawns in fields |
| **ENERGY** (E) | Generated by structures, consumed by buildings |

### 3. Teams
- Team 0 is the human commander; up to 3 additional AI teams (MAX_TEAMS = 4) share the map.
- Each team tracks its own resources, energy pool, building list, and unit list.
- Every team starts with exactly one Construction Yard; losing all yards is immediate defeat and yards cannot be rebuilt.
- A team is eliminated when it has **0 plasma** and **no driller**. Human team elimination ends the game; AI teams are removed and no longer processed.
- Default setup spawns one AI opponent; scenarios can scale up to the max team cap.
- Team colors (console palette): T0 light blue, T1 red, T2 yellow, T3 magenta.
- AI decision logic runs per difficulty level inside `ProcessAITeams` (see AI section).

### 4. AI Profiles
- Each AI team is assigned an attitude at game start:
  - **Aggressive**: higher offensive pressure and faster expansion.
  - **Defensive**: higher defensive focus and safer pacing.
- Each AI tracks a dynamic **mindset** that modifies budget weights:
  - **Idle**: normal long-term plan.
  - **Pressure**: enemy forces threaten buildings or drillers.
  - **Panic**: economy cannot support any mobile unit or power deficit blocks production.
- Mindset changes are evaluated each AI tick using local threat data and affordability checks.

### 4.1 AI Architecture (Budget-Driven)
- **Update cadence:** Base tick is ~500 ms. Process half the AI teams per tick and alternate halves each tick, so each team is refreshed every ~1000 ms.
- **Single action rule:** One action per AI tick. If a condition is met but the action is not possible (resources, power, placement), the AI skips to the next condition.
- **Power gate:** A building that consumes energy cannot be queued if the team has no available energy. Power Plant decisions are evaluated before any other building decision.
- **Budget pools:** The AI converts income and stockpile into four pools:
  - **Economy budget**: drillers, plasma access, escort for drillers.
  - **Infrastructure budget**: required production buildings, tech buildings, expansion.
  - **Defense budget**: turrets, walls, base guard regiments.
  - **Offense budget**: attack units and regiments.
- **Budget weights:** Weights are derived from attitude and mindset.
  - Aggressive: higher offense, lower defense.
  - Defensive: higher defense and infrastructure.
  - Pressure: shift budget into defense and immediate unit production.
  - Panic: shift budget into economy and power first.
- **Budget consumption:** Requests consume their budget pool. Pools refill from plasma income and a controlled share of stored plasma to avoid full stockpile starvation.
- **Priority queues:** Buildings and units have explicit priority values. Priorities are compared within each budget pool.
- **Enemy strength estimation:** Known enemy strength is computed from visible enemy units and buildings only. Observations decay over time and are never based on hidden data. This value influences defensive and offensive budgets.
- **Regiments:** The AI groups units into internal regiments for coordinated attacks and defense.
  - Regiment types: base guard, driller escort, attack group.
  - Scouts are managed independently and always run exploration orders.
  - Regiments have size targets, composition targets, rally points, and mission state.
- **Decision loop overview:**
  1. Update visibility, known enemy strength, and mindset.
  2. Refresh budgets using attitude, mindset, and economy status.
  3. Evaluate the condition list in strict priority order:
     - Power coverage (power plants).
     - Economic survival (drillers, escort, plasma access).
     - Required infrastructure (barracks, factory, tech center).
     - Defensive needs (turrets, walls, base guard).
     - Offensive production (regiments).
  4. Execute the first valid action and return.
- **Robustness rules:**
  - Use hysteresis for budget and mindset changes to avoid oscillation.
  - Add cooldowns on repeated actions to prevent command spam.
  - Reserve plasma for mandatory near-term requirements (power and critical buildings).
  - Throttle production if queues are full or placement repeatedly fails.
  - Track action failures and temporarily reduce their priority after repeated failures.
  - Avoid re-issuing orders to units that already have a valid order.

### 5. Building System

- Buildings take time to construct after placement. While under construction, they show a build-time indicator; once the timer completes, the building becomes usable.

**Construction Yard** - Starting building
- Tech level 1
- Plasma Cost: 1000
- Build Time: 45s
- HP: 500
- Armor: 10
- Energy Cost: 0
- Energy Production: 50
- Moving time: 0s per cell
- Speed: 0
- Sight: 0
- Attack Damage: 0
- Attack Range: 0
- Attack Speed: 0ms
- Produces: Structures

```graphics
/===\
|[Y]|
|_|_|
```

**Barracks** - Infantry production
- Tech level 1
- Plasma Cost: 500
- Build Time: 25s
- HP: 400
- Armor: 10
- Energy Cost: 50
- Energy Production: 0
- Moving time: 0s per cell
- Speed: 0
- Sight: 0
- Attack Damage: 0
- Attack Range: 0
- Attack Speed: 0ms
- Produces: Trooper and Soldier

```graphics
|^^^|
|_B_|
```

**Power Plant** - Energy generation
- Tech level 1
- Plasma Cost: 800
- Build Time: 30s
- HP: 600
- Armor: 10
- Energy Cost: 0
- Energy Production: 100
- Moving time: 0s per cell
- Speed: 0
- Sight: 0
- Attack Damage: 0
- Attack Range: 0
- Attack Speed: 0ms

```graphics
|~~~|
|_P_|
```

**Factory** - Vehicle production
- Tech level 1
- Plasma Cost: 1000
- Build Time: 40s
- HP: 800
- Armor: 10
- Energy Cost: 150
- Energy Production: 0
- Moving time: 0s per cell
- Speed: 0
- Sight: 0
- Attack Damage: 0
- Attack Range: 0
- Attack Speed: 0ms
- Produces: Heavy units

```graphics
~ ~
||||
|_F_|
```

**Tech Center** - Research
- Tech level 1
- Plasma Cost: 1500
- Build Time: 55s
- HP: 1000
- Armor: 10
- Energy Cost: 200
- Energy Production: 0
- Moving time: 0s per cell
- Speed: 0
- Sight: 0
- Attack Damage: 0
- Attack Range: 0
- Attack Speed: 0ms
- Enables tech 2 units/structures

```graphics
| I |
|[=]|
\_T_/
```

**Wall** - Basic defense
- Tech level 2
- Plasma Cost: 25
- Build Time: 2s
- HP: 200
- Armor: 10
- Energy Cost: 0
- Energy Production: 0
- Moving time: 0s per cell
- Speed: 0
- Sight: 0
- Attack Damage: 0
- Attack Range: 0
- Attack Speed: 0ms

```graphics
#
```

**Turret** - Defensive tower
- Tech level 2
- Plasma Cost: 500
- Build Time: 20s
- HP: 600
- Armor: 10
- Energy Cost: 25
- Energy Production: 0
- Moving time: 0s per cell
- Speed: 0
- Sight: 0
- Attack Damage: 10
- Attack Range: 3
- Attack Speed: 1000ms

```graphics
<o>
 |
```

**HP Display (Buildings):** Full numeric HP is shown at the top-left of the icon.

### 6. Unit System

#### Unit States
- **Idle:** No autonomous decision-making (default).
- **Escort:** Follow a designated friendly unit; becomes Idle when the escorted unit is destroyed.
- **Explore:** Auto-selects exploration targets (scouts) or nearest plasma fields (drillers).

#### Infantry

**Trooper**
- Tech level 1
- Plasma Cost: 50
- Build Time: 10s
- HP: 100
- Armor: 5
- Energy Cost: 0
- Energy Production: 0
- Moving time: 2s per cell
- Speed: 3
- Sight: 5
- Attack Damage: 10
- Attack Range: 1
- Attack Speed: 1000ms

```graphics
__
/\
```

**Soldier**
- Tech level 1
- Plasma Cost: 120
- Build Time: 20s
- HP: 150
- Armor: 5
- Energy Cost: 0
- Energy Production: 0
- Moving time: 2s per cell
- Speed: 3
- Sight: 5
- Attack Damage: 20
- Attack Range: 1
- Attack Speed: 1000ms

```graphics
o|
/\
```

**Engineer** - Repairs buildings
- Tech level 1
- Plasma Cost: 200
- Build Time: 25s
- HP: 120
- Armor: 5
- Energy Cost: 0
- Energy Production: 0
- Moving time: 2s per cell
- Speed: 2
- Sight: 4
- Attack Damage: 5
- Attack Range: 1
- Attack Speed: 1000ms

```graphics
--
/\
```

**Scout** - Fast, low combat
- Tech level 1
- Plasma Cost: 80
- Build Time: 10s
- HP: 90
- Armor: 5
- Energy Cost: 0
- Energy Production: 0
- Moving time: 1s per cell
- Speed: 4
- Sight: 6
- Attack Damage: 5
- Attack Range: 1
- Attack Speed: 1000ms

```graphics
oo
/\
```

#### Vehicles

**Mobile Artillery**
- Tech level 2
- Plasma Cost: 300
- Build Time: 60s
- HP: 350
- Armor: 10
- Energy Cost: 0
- Energy Production: 0
- Moving time: 2s per cell
- Speed: 1
- Sight: 6
- Attack Damage: 40
- Attack Range: 6
- Attack Speed: 1000ms

```graphics
 ||
[==]
```

**Driller** - Harvests Plasma
- Tech level 1
- Plasma Cost: 600
- Build Time: 30s
- HP: 400
- Armor: 5
- Energy Cost: 0
- Energy Production: 0
- Moving time: 2s per cell
- Speed: 1
- Sight: 3
- Attack Damage: 0
- Attack Range: 1
- Attack Speed: 1000ms
- Harvest: +20 plasma every 10s if a plasma field is within sight (consumes terrain plasma)

```graphics
[###]
vvvvv
```

**Tank**
- Tech level 2
- Plasma Cost: 400
- Build Time: 90s
- HP: 500
- Armor: 20
- Energy Cost: 0
- Energy Production: 0
- Moving time: 2s per cell
- Speed: 2
- Sight: 3
- Attack Damage: 20
- Attack Range: 3
- Attack Speed: 2000ms

```graphics
 /o\
[===]
```

**Transport**
- Tech level 1
- Plasma Cost: 200
- Build Time: 120s
- HP: 300
- Armor: 5
- Energy Cost: 0
- Energy Production: 0
- Moving time: 2s per cell
- Speed: 3
- Sight: 4
- Attack Damage: 10
- Attack Range: 1
- Attack Speed: 1000ms

```graphics
/==\
|  |
```

**HP Display (Units):** Full numeric HP is shown at the top-left of the icon.

### 7. Control & Interface

#### Menu Levels
- **Units:** Level 1 menu lists available orders (move/attack/escort/explore). Level 2 menu is the confirmation mode for an order on the map.
- **Buildings:** Level 1 menu lists available building actions. Level 2 menu selects the unit type to produce.

#### Bottom Menu Bar (4 pages)

**Page 1: Main Actions**
```
[B]uild  [U]nits  [R]esearch  [M]ap  [O]rders  [S]ave  [L]oad  [Q]uit
```

**Page 2: Construction Yard Build Menu** (when [B] pressed on construction yard)
```
[1] Barracks (600P)  [2] Factory (1350P)  [3] Power Plant (1300P)  [4] Tech Center (2200P)  [5] Turret (400P)  [6] Wall (25P/segment)  [ESC] Cancel
```

**Page 3: Unit Production** (when [B] pressed on Factory)
```
Barracks: [1] Trooper [2] Soldier [3] Engineer [4] Scout  Factory: [1] Artillery [2] Tank [3] Transport [4] Driller  [ESC] Back
```

**Page 4: Orders & Selection**
```
[M] Move  [A] Attack  [E] Escort  [X] Explore  [SPACE] Pause  [ESC] Deselect
```

#### Selection & Control
- **Arrow keys**: Move viewport
- **WASD**: Move viewport (alternative)
- **Click/Target**: Select unit/building
- **Enter**: Confirm selection
- **1-9**: Control groups (select group with Ctrl+1-9, recall with 1-9)
- **Right-click/Enter**: Move/attack with selected units
- **Escort:** Select a friendly unit with the command cursor to escort it.
- **Explore:** Assigns an exploration order to the selected unit.

### 8. Game Mechanics

#### Resource Gathering
- **PLASMA fields** appear as `$` (small) or `$$$` clusters
- **Drillers (D)** harvest Plasma
- **Power Plants** must be built near Construction Yard

#### Fog of War
- Unexplored: ` ` (space)
- Explored: Full terrain representation remains visible
- Visible: Full terrain/unit representation

#### Wraparound Map
- Coordinates use modular arithmetic
- Moving off right edge appears on left edge
- Pathfinding accounts for wrap
- Mini-map shows entire "planet" with viewport rectangle

#### Unit Pathfinding
- Units must compute a walkable path to the target cell instead of stopping at the first obstacle.
- Movement uses 8-direction neighbors (including diagonals) with uniform cost.
- Use BFS for pathfinding; reconstruct the path from a `came_from` grid.
- Blocked cells include impassable terrain (mountains) and occupied tiles (other units/buildings).
- Diagonal movement must not cut corners: a diagonal step is valid only if both adjacent orthogonal cells are walkable.
- Wraparound is supported: neighbors wrap across map edges.

### 9. ASCII Representation Key

```
TERRAIN:
    - Plains (space)
  * - Forest
  $ - Plasma deposit
  ~ - Water
  ^ - Mountain (impassable)

INDICATORS:
  Building and unit colors are set according to team
  ! - Under attack
  / - Low energy

Terrain colors (console palette):
- Plains: dark green
- Forest: light green
- Plasma: orange
- Mountain: dark brown
- Water: dark blue
```

### 10. Progression & Victory Conditions

**Research Tree:**
1. Basic Infantry (starting)
2. Vehicles (requires Barracks)
3. Advanced Units (requires Factory + Tech)
4. Super Weapons (requires multiple Tech Centers)

**Victory:**
- Destroy all enemy Construction Yards
- OR: Control 75% of Plasma fields for 10 minutes
- OR: Build and activate "Omega Device" (end-game research)

**Defeat:**
- Lose all Construction Yards
- Energy deficit for 10 minutes

### 10. Performance Considerations

- Implement "dirty rectangle" rendering for ASCII
- Batch unit updates by distance to viewport
- Cache pathfinding results for common routes
- Use simplified AI outside viewport
