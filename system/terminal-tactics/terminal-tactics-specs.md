# Terminal Tactics - Technical Design Document

## Game Overview
**Terminal Tactics** is a real-time strategy game in pure ASCII with an infinite wraparound planetary map and console-friendly interface.

**Core rule: ALL gameplay rules apply identically to human and AI teams. The only differences are AI decision-making and the absence of UI for AI.**

## Core Architecture

### Display System
```
┌─────────────────────────────────────────────────────┐
│ Day: 14   PLASMA: 5,250    ENERGY: 240/500         │ <- Top Bar (resources)
│ PLASMA: 180       SIGHT: 45°                        │
├─────────────────────────────────────────────────────┤
│ ..............##....$.......                        │
│ ....@@@......###..........##...                     │
│ ....@A@......##...........##...                     │
│ ....@@@.......M1.............$                      │
│ .............###............                        │
│ ..............##.............                       │
│ .........TTT...........&&&...                       │
│ .........T1T...........&B&...                       │
│ .........TTT...........&&&...                       │
│ ..................SS.........                       │
│ ..................SS.........                       │
│ ..................SS.........                       │
│ .....$$$....................                        │
│ .....$C$........................................    │
│ .....$$$........................................    │
├─────────────────────────────────────────────────────┤
│ [B]uild [U]nits [R]esearch [M]ap [O]rders           │ <- Bottom Menu Bar
│ Status                                              │
└─────────────────────────────────────────────────────┘
```

**Viewport:**
- Fixed size: 80x25 characters (80 width, 25 height total)
- Visible map area: 80x20 characters (lines 3-22)
- Top bar: 2 lines
- Bottom menu: 3 lines
- Map scrolls with arrow keys
- **Map wraps infinitely** in all directions (planetary projection)

### 2. Resource System

| Terminal Tactics | Purpose |
|------------------|---------|
| **PLASMA** (P) | Primary currency, spawns in fields |
| **ENERGY** (E) | Generated by structures, consumed by buildings |

### 3. Teams
- Team 0 is the human commander; up to 3 additional AI teams (MAX_TEAMS = 4) share the map.
- Each team tracks its own resources, energy pool, building list, and unit list.
- Every team starts with exactly one Construction Yard; losing all yards is immediate defeat and yards cannot be rebuilt.
- A team is eliminated when it has **0 plasma** and **no driller**. Human team elimination ends the game; AI teams are removed and no longer processed.
- Default setup spawns one AI opponent; scenarios can scale up to the max team cap.
- Team colors (console palette): T0 light blue, T1 red, T2 yellow, T3 magenta.
- AI decision logic runs per difficulty level inside `ProcessAITeams` (see AI section).

### 4. AI Profiles
- Each AI team is randomly assigned an attitude at game start:
  - **Aggressive**: Prioritizes unit production and attacking.
  - **Defensive**: Prioritizes base buildup, defenses, and resource security.
- Each AI tracks a dynamic **mindset**:
  - **Urgency**: Triggered when nearby enemy presence outweighs local defenders within `n` tiles of any AI building.
  - **Idle**: Default state when no nearby threats match the urgency rule.
  - **Panic**: Triggered when available resources are insufficient to produce any mobile unit type.
- Mindset goals:
  - **Idle**: Pursue the primary trait (aggressive → build forces/attack; defensive → fortify/economy).
  - **Urgency**: Focus on neutralizing the immediate threat (defend/respond to detected enemies).
  - **Panic**: Prioritize restoring the economy/energy to regain unit production capability.
- Mindset transitions (evaluated each AI tick):
  - Idle → Urgency: enemy > friendly mobiles within threat radius.
  - Idle → Panic: cannot afford the cheapest mobile unit (plasma/energy).
  - Urgency → Idle: threat cleared (enemy no longer exceeds friendly mobiles in radius).
  - Urgency → Panic: threat persists AND still cannot afford the cheapest mobile unit.
  - Panic → Idle: resources sufficient to build the cheapest mobile unit and no active threat in radius.
  - Panic → Urgency: resources recovered enough for the cheapest mobile unit but threat condition still true.

### 4.1 AI (Standard Mode) Objectives & Loop
- **Update cadence:** Evaluate AI teams every ~500 ms of game time to avoid per-frame cost.
- **Evaluation inputs (per team):** resource stock (plasma/energy), energy balance, cheapest buildable mobile unit affordability, threats near buildings (enemy vs friendly count in radius), owned production buildings (yard/barracks/factory/tech center), size of mobile force.
- **Objective selection:**
  - If the team has no Construction Yard: team is defeated (cannot rebuild yards).
  - If no power margin: prioritize Power Plant.
  - If no barracks: prioritize Barracks (unlocked at tech 1).
  - If tech < 2 and prerequisites unmet: prioritize Tech Center to unlock tech 2 options.
  - If production idle and resources allow: produce mobile units appropriate to tech (trooper/soldier → early; tech 2 vehicles unlocked via factory).
  - If under threat (Urgency/Panic): favor defensive builds/production; otherwise, build up and prepare attacks.
  - If the team has a Tech Center: maintain a **Fortress** plan in parallel with other objectives (see below).
- **Fortress plan (post-Tech Center):**
  - Build a wall ring around the team buildings, keeping a **3-tile clearance** between buildings and the wall.
  - Leave **four gates** (one per cardinal direction) wide enough for the largest mobile unit.
  - Place turrets along the wall perimeter.
  - **Budget weighting by attitude:**
    - **Defensive:** invest heavily in the fortress relative to other objectives.
    - **Aggressive:** invest lightly; fortress is secondary to unit production/attack.
- **Build actions:**
  - Use Construction Yard to queue the highest-priority structure (respect tech level/resource availability and placement queue cap).
  - Auto-place ready structures near the owning yard using a spiral search; skip placement if no free tile is found (retry on next tick).
- **Unit production actions:**
  - Barracks produce infantry (trooper/soldier/engineer) when affordable and not in deficit.
  - Factory (tech 2) produces vehicles when unlocked and affordable.
  - Production choices favor cheaper units in Panic, balanced mix in Urgency, and stronger units in Idle/Aggressive.
- **Unit orders:**
  - Rally point near the team’s yard for newly produced units.
  - Defensive reaction: send available mobiles toward the nearest detected threat when in Urgency/Panic.
  - Offensive push: when force size exceeds a threshold and mindset allows, move/attack toward the closest known enemy structure or last seen yard position.
  - Drillers always move to the nearest plasma field; defensive AI keeps the strongest unit escorting a driller permanently, otherwise it assigns an escort only while the driller is under attack.

### 5. Building System

- Buildings take time to construct after placement. While under construction, they show a build-time indicator; once the timer completes, the building becomes usable.

**Construction Yard** - Starting building
- Tech level 1
- Plasma Cost: 1000
- Energy Cost: 0
- Energy Production: 50
- Produces: Structures
- HP: 500
- Armor: 10
- Build Time: 45s

```graphics
o---o
| C |
o---o
```

**Barracks** - Infantry production
- Tech level 1
- Plasma Cost: 500
- Energy Cost: 50
- Energy Production: 0
- Produces: Trooper and Soldier
- HP: 400
- Armor: 10
- Build Time: 25s

```graphics
+---+
| B |
+---+
```

**Power Plant** - Energy generation
- Tech level 1
- Plasma Cost: 800
- Energy Cost: 0
- Energy Production: 100
- HP: 600
- Armor: 10
- Build Time: 30s

```graphics
/+\
+P+
\+/
```

**Factory** - Vehicle production
- Tech level 1
- Plasma Cost: 1000
- Energy Cost: 150
- Energy Production: 0
- Produces: Heavy units
- HP: 800
- Armor: 10
- Build Time: 40s

```graphics
.:::.
: F :
.:::.
```

**Tech Center** - Research
- Tech level 1
- Plasma Cost: 1500
- Energy Cost: 200
- Energy Production: 0
- Enables tech 2 units/structures
- HP: 1000
- Armor: 10
- Build Time: 55s

```graphics
|---|
| T |
|---|
```

**Wall** - Basic defense
- Tech level 2
- Plasma Cost: 25
- Energy Cost: 0
- Energy Production: 0
- HP: 200
- Armor: 10
- Build Time: 2s

```graphics
#
```

**Turret** - Defensive tower
- Tech level 2
- Plasma Cost: 500
- Energy Cost: 25
- Energy Production: 0
- HP: 600
- Armor: 10
- Attacks nearby enemies
- Build Time: 20s

```graphics
<o>
 |
```

**HP Display (Buildings):** Full numeric HP is shown at the top-left of the icon.

### 6. Unit System

#### Unit States
- **Idle:** No autonomous decision-making (default).
- **Escort:** Follow a designated friendly unit; becomes Idle when the escorted unit is destroyed.
- **Explore:** Auto-selects exploration targets (scouts) or nearest plasma fields (drillers).

#### Infantry

**Trooper**
- Plasma Cost: 50
- Tech level 1
- Build Time: 10s
- HP: 100
- Moving time: 2s per cell
- Attack Damage: 10
- Armor: 5

```graphics
__
/\
```

**Soldier**
- Plasma Cost: 120
- Tech level 1
- Build Time: 20s
- HP: 150
- Moving time: 2s per cell
- Attack Damage: 20
- Armor: 5

```graphics
o|
/\
```

**Engineer** - Repairs buildings
- Plasma Cost: 200
- Tech level 1
- Build Time: 25s
- HP: 120
- Moving time: 2s per cell
- Attack Damage: 5
- Armor: 5

```graphics
--
/\
```

**Scout** - Fast, low combat
- Plasma Cost: 80
- Tech level 1
- Build Time: 10s
- HP: 90
- Moving time: 1s per cell
- Attack Damage: 5
- Armor: 5

```graphics
oo
/\
```

#### Vehicles

**Mobile Artillery**
- Tech level 2
- Plasma Cost: 300
- Build Time: 60s
- HP: 350
- Moving time: 2s per cell
- Attack Damage: 40
- Armor: 15

```graphics
 ||
[==]
```

**Driller** - Harvests Plasma
- Tech level 1
- Plasma Cost: 600
- Build Time: 30s
- HP: 400
- Harvest: +20 plasma every 10s if a plasma field is within sight (consumes terrain plasma)
- Moving time: 2s per cell
- Attack Damage: 0
- Armor: 10

```graphics
[###]
vvvvv
```

**Tank**
- Tech level 2
- Plasma Cost: 400
- Build Time: 90s
- HP: 500
- Moving time: 2s per cell
- Attack Damage: 10
- Armor: 30

```graphics
 /o\
[===]
```

**Transport**
- Tech level 1
- Plasma Cost: 200
- Build Time: 120s
- HP: 300
- Moving time: 2s per cell
- Attack Damage: 10
- Armor: 10

```graphics
/==\
|  |
```

**HP Display (Units):** Full numeric HP is shown at the top-left of the icon.

### 7. Control & Interface

#### Menu Levels
- **Units:** Level 1 menu lists available orders (move/attack/escort/explore). Level 2 menu is the confirmation mode for an order on the map.
- **Buildings:** Level 1 menu lists available building actions. Level 2 menu selects the unit type to produce.

#### Bottom Menu Bar (4 pages)

**Page 1: Main Actions**
```
[B]uild  [U]nits  [R]esearch  [M]ap  [O]rders  [S]ave  [L]oad  [Q]uit
```

**Page 2: Construction Yard Build Menu** (when [B] pressed on construction yard)
```
[1] Barracks (600P)  [2] Factory (1350P)  [3] Power Plant (1300P)  [4] Tech Center (2200P)  [5] Turret (400P)  [6] Wall (25P/segment)  [ESC] Cancel
```

**Page 3: Unit Production** (when [B] pressed on Factory)
```
Barracks: [1] Trooper [2] Soldier [3] Engineer [4] Scout  Factory: [1] Artillery [2] Tank [3] Transport [4] Driller  [ESC] Back
```

**Page 4: Orders & Selection**
```
[M] Move  [A] Attack  [E] Escort  [X] Explore  [SPACE] Pause  [ESC] Deselect
```

#### Selection & Control
- **Arrow keys**: Move viewport
- **WASD**: Move viewport (alternative)
- **Click/Target**: Select unit/building
- **Enter**: Confirm selection
- **1-9**: Control groups (select group with Ctrl+1-9, recall with 1-9)
- **Right-click/Enter**: Move/attack with selected units
- **Escort:** Select a friendly unit with the command cursor to escort it.
- **Explore:** Assigns an exploration order to the selected unit.

### 8. Game Mechanics

#### Resource Gathering
- **PLASMA fields** appear as `$` (small) or `$$$` clusters
- **Drillers (D)** harvest Plasma
- **Power Plants** must be built near Construction Yard

#### Fog of War
- Unexplored: ` ` (space)
- Explored: Full terrain representation remains visible
- Visible: Full terrain/unit representation

#### Wraparound Map
- Coordinates use modular arithmetic
- Moving off right edge appears on left edge
- Pathfinding accounts for wrap
- Mini-map shows entire "planet" with viewport rectangle

#### Unit Pathfinding
- Units must compute a walkable path to the target cell instead of stopping at the first obstacle.
- Movement uses 8-direction neighbors (including diagonals) with uniform cost.
- Use BFS for pathfinding; reconstruct the path from a `came_from` grid.
- Blocked cells include impassable terrain (mountains) and occupied tiles (other units/buildings).
- Diagonal movement must not cut corners: a diagonal step is valid only if both adjacent orthogonal cells are walkable.
- Wraparound is supported: neighbors wrap across map edges.

### 9. ASCII Representation Key

```
TERRAIN:
    - Plains (space)
  * - Forest
  $ - Plasma deposit
  ~ - Water
  ^ - Mountain (impassable)

INDICATORS:
  Building and unit colors are set according to team
  ! - Under attack
  / - Low energy

Terrain colors (console palette):
- Plains: dark green
- Forest: light green
- Plasma: orange
- Mountain: dark brown
- Water: dark blue
```

### 10. Progression & Victory Conditions

**Research Tree:**
1. Basic Infantry (starting)
2. Vehicles (requires Barracks)
3. Advanced Units (requires Factory + Tech)
4. Super Weapons (requires multiple Tech Centers)

**Victory:**
- Destroy all enemy Construction Yards
- OR: Control 75% of Plasma fields for 10 minutes
- OR: Build and activate "Omega Device" (end-game research)

**Defeat:**
- Lose all Construction Yards
- Energy deficit for 10 minutes

### 10. Performance Considerations

- Implement "dirty rectangle" rendering for ASCII
- Batch unit updates by distance to viewport
- Cache pathfinding results for common routes
- Use simplified AI outside viewport
